<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼çµ„ç¹”æ•ˆèƒ½è¨ºæ–·å ±å‘Š (Gemini å¢å¼·ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The SPA is designed with a top-down, dashboard-like approach. The user starts with a high-level "ç¸½è¦½" (Overview) featuring key challenges and a core data visualization. They can then drill down into "å•é¡Œè¨ºæ–·" (Problem Diagnosis) to explore the four detailed findings via an interactive tab system, preventing information overload. Finally, the "è½‰å‹è—åœ–" (Transformation Blueprint) section presents the solution as an interactive, three-stage timeline. This structure guides the user from the "what" (problem) to the "why" (analysis) and finally the "how" (solution) in an intuitive, non-linear flow that enhances comprehension and engagement over a static document. -->
    <!-- Visualization & Content Choices: 
        1. Report Info: Executive Summary's 30% wasted management time. -> Goal: Inform/Impact. -> Viz: Donut Chart. -> Interaction: Hover for details. -> Justification: Visually striking, immediately communicates the scale of the efficiency problem. -> Library: Chart.js (Canvas).
        2. Report Info: Four detailed findings (2.1-2.4). -> Goal: Organize/Compare. -> Presentation: Interactive Tabbed Interface. -> Interaction: Click tabs to reveal detailed content (Observations vs. Root Cause). -> Justification: Breaks down dense information into manageable chunks, allowing users to focus on one issue at a time. -> Library/Method: Vanilla JS + HTML/CSS.
        3. Report Info: Three-stage transformation plan (3.1-3.3). -> Goal: Change/Organize. -> Presentation: Interactive Timeline/Stage cards. -> Interaction: Click on a stage to expand and view detailed actions. -> Justification: Visualizes the phased approach, making the strategic plan clearer and more digestible than a long list. -> Library/Method: Vanilla JS + HTML/CSS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF8;
            color: #3D405B;
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            color: #3A86FF;
            border-bottom-color: #3A86FF;
        }
        .tab-btn.active {
            background-color: #3A86FF;
            color: #FFFFFF;
        }
        .stage-card.active {
            border-color: #3A86FF;
            box-shadow: 0 4px 14px 0 rgba(58, 134, 255, 0.1);
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .gemini-btn {
            background: linear-gradient(135deg, #6a82fb, #fc5c7d);
            transition: all 0.3s ease;
        }
        .gemini-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3A86FF;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">çµ„ç¹”æ•ˆèƒ½è¨ºæ–·å ±å‘Š</h1>
                <p class="text-sm text-gray-500">âœ¨ Gemini å¢å¼·ç‰ˆ</p>
            </div>
            <div class="hidden md:flex space-x-8">
                <a href="#overview" class="nav-link active font-medium pb-1">ç¸½è¦½</a>
                <a href="#diagnosis" class="nav-link font-medium pb-1">å•é¡Œè¨ºæ–·</a>
                <a href="#blueprint" class="nav-link font-medium pb-1">è½‰å‹è—åœ–</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-8 md:py-12">

        <section id="overview" class="content-section active">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">ä¸‰å¤§æ ¸å¿ƒæŒ‘æˆ°</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">å…¬å¸æˆé•·å‹•èƒ½å—é™æ–¼ç®¡ç†ã€äººæ‰èˆ‡çŸ¥è­˜ä¸‰å¤§å±¤é¢çš„å…§éƒ¨ç“¶é ¸ã€‚</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8 mb-16">
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200/80">
                    <div class="text-3xl mb-4 text-blue-500">â”</div>
                    <h3 class="text-xl font-bold mb-2">ç®¡ç†æ¬Šè²¬å¤±è¡¡</h3>
                    <p class="text-gray-600">é«˜éšä¸»ç®¡éåº¦æ¶‰å…¥æ—¥å¸¸ç‘£äº‹ï¼Œæ±ºç­–æ•ˆç‡ä½ä¸‹ï¼ŒæŠ‘åˆ¶ä¸­éšäººæ‰æˆé•·èˆ‡ä¼æ¥­æˆ°ç•¥è¦åŠƒã€‚</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200/80">
                    <div class="text-3xl mb-4 text-amber-500">â”</div>
                    <h3 class="text-xl font-bold mb-2">äººæ‰ç­–ç•¥åƒµåŒ–</h3>
                    <p class="text-gray-600">ç¼ºä¹ç³»çµ±æ€§å“¡å·¥é—œæ‡·èˆ‡åŸ¹è¨“ï¼Œçµ„ç¹”æ´»åŠ›åŒ±ä¹ï¼Œé›£ä»¥å¸å¼•ä¸¦ç•™ä½è¿½æ±‚æˆé•·çš„æ–°ä¸–ä»£äººæ‰ã€‚</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200/80">
                    <div class="text-3xl mb-4 text-emerald-500">â”</div>
                    <h3 class="text-xl font-bold mb-2">çŸ¥è­˜è³‡ç”¢æµå¤±</h3>
                    <p class="text-gray-600">æ ¸å¿ƒçŸ¥è­˜èˆ‡æµç¨‹é«˜åº¦ä¾è³´å€‹äººç¶“é©—ï¼Œå‚³æ‰¿é¢è‡¨æ–·å±¤é¢¨éšªï¼Œé™åˆ¶äº†ä¼æ¥­çš„è¦æ¨¡åŒ–æ“´å¼µã€‚</p>
                </div>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200/80">
                <h3 class="text-2xl font-bold text-center mb-2">é«˜éšç®¡ç†å±¤æ™‚é–“åˆ†é…è­¦è¨Š</h3>
                <p class="text-center text-gray-600 mb-6">åˆæ­¥ä¼°ç®—ï¼Œé«˜éšä¸»ç®¡ç´„æœ‰30%çš„å¯¶è²´å·¥æ™‚è¢«ä½é™„åŠ åƒ¹å€¼äº‹å‹™æ‰€ä½”æ“šã€‚</p>
                <div class="chart-container">
                    <canvas id="timeAllocationChart"></canvas>
                </div>
            </div>
        </section>

        <section id="diagnosis" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">å››å¤§æ ¸å¿ƒç™¼ç¾</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">é»æ“Šä¸‹æ–¹é ç±¤ï¼Œæ·±å…¥äº†è§£é™åˆ¶çµ„ç¹”ç™¼å±•çš„æ ¹æœ¬å•é¡Œã€‚</p>
            </div>
            <div id="diagnosis-tabs" class="mb-8 flex flex-wrap justify-center gap-2 md:gap-4"></div>
            <div id="diagnosis-content" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200/80 min-h-[300px]"></div>
        </section>

        <section id="blueprint" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">ä¸‰éšæ®µè½‰å‹è¡Œå‹•è—åœ–</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">ä¸€å¥—ç”±æ·ºå…¥æ·±ã€å¾ªåºæ¼¸é€²çš„ç³»çµ±æ€§æ”¹é©æ–¹æ¡ˆã€‚é»æ“Šå¡ç‰‡æŸ¥çœ‹å„éšæ®µè¡Œå‹•ç´°ç¯€ã€‚</p>
            </div>
            <div id="blueprint-stages" class="grid md:grid-cols-3 gap-8"></div>
            <div id="blueprint-details" class="mt-8 bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200/80 min-h-[200px]"></div>
        </section>

    </main>
    
    <footer class="text-center py-8 mt-12 border-t">
        <p class="text-gray-500">&copy; 2025 ç­–ç•¥é¡§å•ã€‚æ­¤ç‚ºåŸºæ–¼çœŸå¯¦è§€å¯Ÿçš„æ¨¡æ“¬åˆ†æå ±å‘Šã€‚</p>
    </footer>

    <div id="gemini-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="gemini-modal-title" class="text-xl font-bold">âœ¨ Gemini AI æ™ºæ…§åŠ©ç†</h3>
                <button id="gemini-modal-close" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="gemini-modal-content" class="p-6 overflow-y-auto">
                <div class="flex justify-center items-center h-48">
                    <div class="loader"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const appData = {
            diagnosis: [
                {
                    id: 'management',
                    title: 'æ±ºç­–èˆ‡è·è²¬ç“¶é ¸',
                    icon: 'âš™ï¸',
                    content: {
                        observation: {
                            title: 'è§€å¯Ÿç¾è±¡',
                            points: [
                                '<strong>æ±ºç­–æµç¨‹ä¸­å¿ƒåŒ–ï¼š</strong>æ‰€æœ‰å±¤ç´šæ±ºç­–å‡éœ€ä¸Šå‘ˆè‡³ç¸½ç¶“ç†ï¼Œå°è‡´æ±ºç­–é€±æœŸå†—é•·ã€‚',
                                '<strong>é«˜éšè·èƒ½åŸºå±¤åŒ–ï¼š</strong>å‰¯ç¸½è™•ç†é›¶ä»¶æ¡è³¼ä¿¡ä»¶ã€æŠ€è¡“ç¸½ç›£è¦ªè‡ªæ‰“ç£¨é›¶ä»¶ç­‰å¯¦ä¾‹é »ç¹ç™¼ç”Ÿã€‚'
                            ]
                        },
                        analysis: {
                            title: 'æ ¹æœ¬å•é¡Œåˆ†æ',
                            points: [
                                '<strong>äººæ‰éŒ¯é…èˆ‡æ©Ÿæœƒæˆæœ¬ï¼š</strong>é«˜éšä¸»ç®¡æ™‚é–“è¢«æŠ•å…¥æ–¼ä½é™„åŠ åƒ¹å€¼ä»»å‹™ï¼ŒéŒ¯å¤±ç­–ç•¥è¦åŠƒçš„æ©Ÿæœƒã€‚',
                                '<strong>ä¸­éšç®¡ç†å±¤å¼±åŒ–ï¼š</strong>ç¼ºä¹æˆæ¬Šå°è‡´ä¸­éšä¸»ç®¡èƒ½åŠ›ç„¡æ³•åŸ¹é¤Šï¼Œå½¢æˆçµ„ç¹”ç™¼å±•æ–·å±¤ã€‚',
                                '<strong>ç‡Ÿé‹æ•ˆç‡å—æï¼š</strong>éé•·çš„æ±ºç­–éˆèˆ‡ä¸åˆç†åˆ†å·¥ï¼Œç›´æ¥å°è‡´å…§éƒ¨æµç¨‹æ•ˆç‡ä½ä¸‹ã€‚'
                            ]
                        }
                    }
                },
                {
                    id: 'talent',
                    title: 'äººæ‰ç­–ç•¥åŒ±ä¹',
                    icon: 'ğŸ‘¥',
                    content: {
                        observation: {
                            title: 'è§€å¯Ÿç¾è±¡',
                            points: [
                                '<strong>å“¡å·¥é—œæ‡·èˆ‡ç¦åˆ©ç¼ºå¤±ï¼š</strong>é£²æ°´æ©Ÿè€èˆŠã€æä¾›ä»˜è²»å’–å•¡ç­‰ç´°ç¯€ï¼Œå½±éŸ¿æ­¸å±¬æ„Ÿã€‚',
                                '<strong>ç®¡ç†åˆ¶åº¦åƒµåŒ–ä¸”é›™é‡æ¨™æº–ï¼š</strong>åš´æ ¼è€ƒå‹¤ï¼Œä½†æœƒè­°å»å¸¸ä½”ç”¨å“¡å·¥ä¼‘æ¯æ™‚é–“ä¸”ç„¡è£œå„Ÿã€‚',
                                '<strong>ç¼ºä¹æˆé•·è·¯å¾‘èˆ‡åŸ¹è¨“ï¼š</strong>äººè³‡è§’è‰²è¢«å‹•ï¼Œå“¡å·¥æ™®éæ„Ÿå—ä¸åˆ°æˆé•·å‰æ™¯ã€‚'
                            ]
                        },
                        analysis: {
                            title: 'æ ¹æœ¬å•é¡Œåˆ†æ',
                            points: [
                                '<strong>ä½å“¡å·¥æ•¬æ¥­åº¦ï¼š</strong>å°‡å“¡å·¥è¦–ç‚ºã€Œå·¥å…·ã€çš„ç®¡ç†æ€ç¶­ï¼Œåš´é‡æ‰“æ“Šå£«æ°£èˆ‡èªåŒæ„Ÿã€‚',
                                '<strong>äººæ‰å¸å¼•åŠ›ä¸è¶³ï¼š</strong>å‚³çµ±ä¿å®ˆçš„æ–‡åŒ–é›£ä»¥å¸å¼•å’Œç•™ä½æ–°ä¸–ä»£å„ªç§€äººæ‰ã€‚'
                            ]
                        }
                    }
                },
                {
                    id: 'culture',
                    title: 'å”ä½œæ–‡åŒ–è–„å¼±',
                    icon: 'ğŸ§±',
                    content: {
                        observation: {
                            title: 'è§€å¯Ÿç¾è±¡',
                            points: [
                                '<strong>å­¤å³¶æ•ˆæ‡‰ (Silo Effect)ï¼š</strong>å„éƒ¨é–€ã€Œå„è‡ªç‚ºæ”¿ã€ï¼Œç¼ºä¹æ©«å‘æºé€šï¼Œè¦é¿è·¨éƒ¨é–€è²¬ä»»ã€‚',
                                '<strong>æ¶ˆæ¥µçš„å•é¡Œæ‡‰å°æ–‡åŒ–ï¼š</strong>å“¡å·¥ç™¼ç¾å•é¡Œå‚¾å‘æ²‰é»˜ï¼Œå¾…å•é¡Œçˆ†ç™¼å¾Œå†ç›¸äº’æ¨è«‰ã€‚',
                                '<strong>ä½æ•ˆçš„æœƒè­°æ–‡åŒ–ï¼š</strong>æœƒè­°å¸¸è‡¨æ™‚é€šçŸ¥ã€ç¼ºä¹è­°ç¨‹ã€é‚€è«‹éå¤šç„¡é—œäººå“¡ã€‚'
                            ]
                        },
                        analysis: {
                            title: 'æ ¹æœ¬å•é¡Œåˆ†æ',
                            points: [
                                '<strong>æ‰¼æ®ºå‰µæ–°èˆ‡æ•æ·æ€§ï¼š</strong>ç¼ºä¹å¿ƒç†å®‰å…¨æ„Ÿçš„æ°›åœï¼Œä½¿çµ„ç¹”ç„¡æ³•å¿«é€Ÿæ‡‰å°å¤–éƒ¨è®ŠåŒ–ã€‚',
                                '<strong>éš±æ€§æˆæœ¬é«˜æ˜‚ï¼š</strong>å¤§é‡ç„¡æ•ˆæœƒè­°èˆ‡æºé€šä¸æš¢ï¼Œç›´æ¥æµªè²»é«˜æ˜‚çš„äººåŠ›èˆ‡æ™‚é–“æˆæœ¬ã€‚'
                            ]
                        }
                    }
                },
                {
                    id: 'knowledge',
                    title: 'çŸ¥è­˜ç®¡ç†é—•å¦‚',
                    icon: 'ğŸ“š',
                    content: {
                        observation: {
                            title: 'è§€å¯Ÿç¾è±¡',
                            points: [
                                '<strong>éš±æ€§çŸ¥è­˜æœªé¡¯æ€§åŒ–ï¼š</strong>é—œéµçŸ¥è­˜åƒ…å­˜æ–¼è³‡æ·±å“¡å·¥è¨˜æ†¶ä¸­ï¼Œç„¡æ›¸é¢æ‰‹å†Šæˆ–SOPã€‚',
                                '<strong>è³‡è¨Šç³»çµ±æ··äº‚ï¼š</strong>å…±ç”¨æ–‡ä»¶å¤¾æ¶æ§‹èˆ‡å‘½åæ··äº‚ï¼Œè³‡æ–™æª¢ç´¢å›°é›£ã€‚',
                                '<strong>æ–°é€²äººå“¡åŸ¹è¨“ä¸è¶³ï¼š</strong>åŸ¹è¨“é«˜åº¦ä¾è³´å£è€³ç›¸å‚³ï¼Œå­¸ç¿’æ›²ç·šé™¡å³­ã€‚'
                            ]
                        },
                        analysis: {
                            title: 'æ ¹æœ¬å•é¡Œåˆ†æ',
                            points: [
                                '<strong>é«˜ç‡Ÿé‹é¢¨éšªï¼š</strong>æ ¸å¿ƒçŸ¥è­˜èˆ‡äººå“¡é«˜åº¦ç¶å®šï¼Œè³‡æ·±å“¡å·¥é›¢è·å°‡å°è‡´çŸ¥è­˜æ–·å±¤ã€‚',
                                '<strong>è¦æ¨¡åŒ–ç™¼å±•å—é™ï¼š</strong>ç¼ºä¹å¯è¤‡è£½çš„çŸ¥è­˜é«”ç³»ï¼Œé™åˆ¶äº†æœªä¾†çš„æˆé•·æ½›åŠ›ã€‚'
                            ]
                        }
                    }
                }
            ],
            blueprint: [
                {
                    id: 'stage1',
                    title: 'ç¬¬ä¸€éšæ®µ (å‰3å€‹æœˆ)',
                    subtitle: 'æ•ˆèƒ½å„ªåŒ–èˆ‡è³¦èƒ½æˆæ¬Š',
                    icon: 'ğŸš€',
                    details: {
                        objective: 'å¿«é€Ÿé‡‹æ”¾é«˜éšäººæ‰ç”¢å€¼ï¼Œæå‡æ—¥å¸¸ç‡Ÿé‹æ•ˆç‡ï¼Œå»ºç«‹æˆæ¬ŠåŸºç¤ã€‚',
                        actions: [
                            '<strong>é«˜éšä¸»ç®¡è·è²¬å†èšç„¦ï¼š</strong>ä½¿ç”¨RACIè²¬ä»»åˆ†é…çŸ©é™£ï¼Œæ˜ç¢ºå„å±¤ç´šæ¬Šè²¬ã€‚',
                            '<strong>ä½é™„åŠ åƒ¹å€¼ä»»å‹™å¤–åŒ…è©•ä¼°ï¼š</strong>ç›¤é»ä¸¦å•Ÿå‹•åŸºç¤åŠ å·¥ä½œæ¥­å¤–åŒ…ç¨‹åºã€‚',
                            '<strong>æ¥­å‹™åœ˜éšŠè·èƒ½å°ˆæ¥­åŒ–ï¼š</strong>å°‡è¡ŒéŠ·ã€ç¶²ç«™ç®¡ç†ç­‰éæ ¸å¿ƒè·èƒ½å‰é›¢ã€‚'
                        ]
                    }
                },
                {
                    id: 'stage2',
                    title: 'ç¬¬äºŒéšæ®µ (3-9å€‹æœˆ)',
                    subtitle: 'äººæ‰æ´»åŒ–èˆ‡æ–‡åŒ–é‡å¡‘',
                    icon: 'ğŸŒ±',
                    details: {
                        objective: 'æå‡å“¡å·¥æ•¬æ¥­åº¦èˆ‡æ­¸å±¬æ„Ÿï¼Œå»ºç«‹æ­£å‘ã€å”ä½œçš„çµ„ç¹”æ–‡åŒ–ã€‚',
                        actions: [
                            '<strong>æ¨å‹•ã€Œæœ‰æ„Ÿã€çš„å“¡å·¥é—œæ‡·è¨ˆç•«ï¼š</strong>æ”¹å–„è¾¦å…¬è¨­æ–½ã€å°Šé‡å“¡å·¥ä¼‘æ¯æ™‚é–“ã€‚',
                            '<strong>å»ºç«‹é›™å‘æºé€šèˆ‡å›é¥‹æ©Ÿåˆ¶ï¼š</strong>æ¨è¡Œå®šæœŸä¸€å°ä¸€æœƒè­°èˆ‡åŒ¿åå»ºè­°å¹³å°ã€‚',
                            '<strong>å„ªåŒ–æœƒè­°ç®¡ç†æµç¨‹ï¼š</strong>æ¨è¡Œé«˜æ•ˆæœƒè­°æº–å‰‡ï¼ˆè­°ç¨‹ã€ç›®æ¨™ã€è¡Œå‹•é …ç›®ï¼‰ã€‚'
                        ]
                    }
                },
                {
                    id: 'stage3',
                    title: 'ç¬¬ä¸‰éšæ®µ (9å€‹æœˆä»¥ä¸Š)',
                    subtitle: 'çŸ¥è­˜æ•¸ä½åŒ–èˆ‡èƒ½åŠ›å»ºæ§‹',
                    icon: 'ğŸ›ï¸',
                    details: {
                        objective: 'å°‡å€‹äººç¶“é©—è½‰åŒ–ç‚ºçµ„ç¹”è³‡ç”¢ï¼Œå»ºç«‹å¯æŒçºŒçš„äººæ‰ç™¼å±•èˆ‡çŸ¥è­˜å‚³æ‰¿é«”ç³»ã€‚',
                        actions: [
                            '<strong>å•Ÿå‹•çŸ¥è­˜ç›¤é»èˆ‡æ¨™æº–åŒ–å°ˆæ¡ˆï¼š</strong>ç³»çµ±åŒ–æ¢³ç†æ ¸å¿ƒçŸ¥è­˜ä¸¦è£½ä½œé›»å­æ–‡ä»¶ã€‚',
                            '<strong>å»ºç½®ä¸­å¤®çŸ¥è­˜å¹³å° (Knowledge Hub)ï¼š</strong>å°å…¥é›²ç«¯çŸ¥è­˜åº«å·¥å…·ï¼Œå»ºç«‹å–®ä¸€è³‡è¨Šä¾†æºã€‚',
                            '<strong>æ§‹å»ºçµæ§‹åŒ–çš„äººæ‰ç™¼å±•é«”ç³»ï¼š</strong>è¨­è¨ˆæ–°é€²å“¡å·¥å­¸ç¿’åœ°åœ–èˆ‡å…¨å“¡è·æ¶¯ç™¼å±•è·¯å¾‘ã€‚'
                        ]
                    }
                }
            ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const diagnosisTabsContainer = document.getElementById('diagnosis-tabs');
            const diagnosisContentContainer = document.getElementById('diagnosis-content');
            const blueprintStagesContainer = document.getElementById('blueprint-stages');
            const blueprintDetailsContainer = document.getElementById('blueprint-details');
            const modal = document.getElementById('gemini-modal');
            const modalTitle = document.getElementById('gemini-modal-title');
            const modalContent = document.getElementById('gemini-modal-content');
            const modalCloseBtn = document.getElementById('gemini-modal-close');

            const apiKey = ""; 

            async function callGeminiAPI(prompt, maxRetries = 3) {
                const apiUrl = '/api/gemini'; // å‘¼å«è‡ªå·±çš„å¾Œç«¯
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ prompt })
                        });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            return result.candidates[0].content.parts[0].text;
                        } else {
                            throw new Error('Invalid response structure from Gemini API');
                        }
                    } catch (error) {
                        if (i === maxRetries - 1) {
                            return `ç„¡æ³•é€£æ¥è‡³ AI åŠ©ç†ã€‚è«‹ç¨å¾Œå†è©¦ã€‚éŒ¯èª¤ï¼š${error.message}`;
                        }
                        await new Promise(res => setTimeout(res, Math.pow(2, i) * 1000));
                    }
                }
            }
            
            function showModal(title) {
                modalTitle.textContent = title;
                modalContent.innerHTML = `<div class="flex justify-center items-center h-48"><div class="loader"></div></div>`;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function hideModal() {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            modalCloseBtn.addEventListener('click', hideModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });

            function setupNavigation() {
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href').substring(1);

                        navLinks.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');

                        contentSections.forEach(section => {
                            section.classList.remove('active');
                            if (section.id === targetId) {
                                section.classList.add('active');
                            }
                        });
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                });
            }

            function renderDiagnosisTabs() {
                appData.diagnosis.forEach((item, index) => {
                    const button = document.createElement('button');
                    button.className = `tab-btn px-4 py-2 text-sm md:text-base font-medium rounded-full transition-colors duration-300 ${index === 0 ? 'active' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                    button.dataset.id = item.id;
                    button.innerHTML = `${item.icon} ${item.title}`;
                    diagnosisTabsContainer.appendChild(button);
                });

                diagnosisTabsContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab-btn')) {
                        const targetId = e.target.dataset.id;
                        document.querySelectorAll('.tab-btn').forEach(btn => {
                            btn.classList.remove('active', 'bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                            btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                        });
                        e.target.classList.add('active');
                        e.target.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                        renderDiagnosisContent(targetId);
                    }
                });

                renderDiagnosisContent(appData.diagnosis[0].id);
            }

            function renderDiagnosisContent(id) {
                const item = appData.diagnosis.find(d => d.id === id);
                if (!item) return;
                
                diagnosisContentContainer.innerHTML = `
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-xl font-bold mb-4 text-gray-800">${item.content.observation.title}</h4>
                            <ul class="space-y-3 text-gray-600 list-disc list-inside">
                                ${item.content.observation.points.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="border-t md:border-t-0 md:border-l border-gray-200 pt-6 md:pt-0 md:pl-8">
                            <h4 class="text-xl font-bold mb-4 text-red-600">${item.content.analysis.title}</h4>
                            <ul class="space-y-3 text-gray-600 list-disc list-inside">
                                ${item.content.analysis.points.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <button class="gemini-btn text-white font-bold py-2 px-6 rounded-full" data-gemini-id="${id}" data-gemini-type="diagnosis">âœ¨ ç”¢ç”Ÿè§£æ±ºæ–¹æ¡ˆå»ºè­°</button>
                    </div>
                `;
                diagnosisContentContainer.querySelector('[data-gemini-id]').addEventListener('click', handleGeminiClick);
            }
            
            function renderBlueprintStages() {
                appData.blueprint.forEach((stage, index) => {
                    const card = document.createElement('div');
                    card.className = `stage-card bg-white p-6 rounded-xl shadow-md border-2 border-transparent cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 ${index === 0 ? 'active' : ''}`;
                    card.dataset.id = stage.id;
                    card.innerHTML = `
                        <div class="text-4xl mb-4">${stage.icon}</div>
                        <h3 class="text-lg font-bold">${stage.title}</h3>
                        <p class="text-gray-600">${stage.subtitle}</p>
                    `;
                    blueprintStagesContainer.appendChild(card);
                });

                blueprintStagesContainer.addEventListener('click', (e) => {
                    const card = e.target.closest('.stage-card');
                    if (card) {
                        const targetId = card.dataset.id;
                        document.querySelectorAll('.stage-card').forEach(c => c.classList.remove('active'));
                        card.classList.add('active');
                        renderBlueprintDetails(targetId);
                    }
                });

                renderBlueprintDetails(appData.blueprint[0].id);
            }

            function renderBlueprintDetails(id) {
                const stage = appData.blueprint.find(b => b.id === id);
                if (!stage) return;

                blueprintDetailsContainer.innerHTML = `
                    <h4 class="text-xl font-bold mb-2 text-gray-800">ç›®æ¨™ï¼š${stage.details.objective}</h4>
                    <p class="text-gray-600 mb-6">ä¸»è¦è¡Œå‹•é …ç›®ï¼š</p>
                    <ul class="space-y-4 text-gray-700 list-decimal list-inside">
                        ${stage.details.actions.map(a => `<li>${a}</li>`).join('')}
                    </ul>
                    <div class="mt-8 text-center">
                        <button class="gemini-btn text-white font-bold py-2 px-6 rounded-full" data-gemini-id="${id}" data-gemini-type="blueprint">âœ¨ è‰æ“¬å…§éƒ¨æºé€šéƒµä»¶</button>
                    </div>
                `;
                blueprintDetailsContainer.querySelector('[data-gemini-id]').addEventListener('click', handleGeminiClick);
            }

            async function handleGeminiClick(e) {
                const id = e.target.dataset.geminiId;
                const type = e.target.dataset.geminiType;
                let prompt = '';
                let modalTitleText = '';

                if (type === 'diagnosis') {
                    const item = appData.diagnosis.find(d => d.id === id);
                    modalTitleText = `é‡å°ã€Œ${item.title}ã€çš„è§£æ±ºæ–¹æ¡ˆå»ºè­°`;
                    prompt = `ä½œç‚ºä¸€åè³‡æ·±ç®¡ç†é¡§å•ï¼Œè«‹é‡å°ä»¥ä¸‹çš„çµ„ç¹”å•é¡Œã€Œ${item.title}ã€ï¼Œå…¶å…·é«”ç¾è±¡ç‚ºï¼šã€Œ${item.content.observation.points.join('; ')}ã€ï¼Œæ ¹æœ¬åŸå› ç‚ºï¼šã€Œ${item.content.analysis.points.join('; ')}ã€ã€‚è«‹æå‡ºä¸‰å€‹å…·é«”ã€å¯åŸ·è¡Œçš„åˆæ­¥è§£æ±ºæ–¹æ¡ˆå»ºè­°ï¼Œä¸¦ä»¥é»åˆ—å¼å‘ˆç¾ã€‚`;
                } else if (type === 'blueprint') {
                    const stage = appData.blueprint.find(b => b.id === id);
                    modalTitleText = `é—œæ–¼ã€Œ${stage.subtitle}ã€çš„å…§éƒ¨æºé€šéƒµä»¶è‰ç¨¿`;
                    prompt = `ä½œç‚ºå…¬å¸çš„æ–°ä»»é ˜å°è€…ï¼Œè«‹è‰æ“¬ä¸€å°æ¸…æ™°ã€ç°¡æ½”ä¸”é¼“èˆäººå¿ƒçš„å…§éƒ¨æºé€šéƒµä»¶ï¼Œå‘å…¨é«”å“¡å·¥å®£å¸ƒå³å°‡å•Ÿå‹•ã€Œ${stage.title}: ${stage.subtitle}ã€ã€‚éƒµä»¶éœ€è¦èªªæ˜é€™æ¬¡è®Šé©çš„ã€Œç‚ºä»€éº¼ã€ï¼ˆç›®æ¨™æ˜¯ï¼š${stage.details.objective}ï¼‰ï¼Œä¸¦ç°¡è¦æåŠå°‡æ¡å–çš„è¡Œå‹•ï¼ˆä¾‹å¦‚ï¼š${stage.details.actions.join(', ')}ï¼‰ï¼Œä»¥çˆ­å–å“¡å·¥çš„ç†è§£èˆ‡æ”¯æŒã€‚`;
                }

                showModal(modalTitleText);
                const result = await callGeminiAPI(prompt);
                modalContent.innerHTML = `<div class="prose max-w-none">${result.replace(/\n/g, '<br>')}</div>`;
            }

            function renderTimeAllocationChart() {
                const ctx = document.getElementById('timeAllocationChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ä½é™„åŠ åƒ¹å€¼äº‹å‹™', 'æ ¸å¿ƒç­–ç•¥äº‹å‹™'],
                        datasets: [{
                            data: [30, 70],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 14,
                                        family: "'Noto Sans TC', sans-serif"
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + '% çš„å·¥æ™‚';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            setupNavigation();
            renderDiagnosisTabs();
            renderBlueprintStages();
            renderTimeAllocationChart();
        });
    </script>
</body>
</html>
